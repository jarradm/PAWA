@{
    ViewBag.Title = "Album";
}

<link rel="stylesheet" href="~/App_Themes/Album.css" type="text/css" />
<script src="~/Scripts/GridOptionHandle.js" type="text/javascript"></script>

<div id="body-area">
    <div id="body-content-area">
        @using (Html.BeginForm("Album", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <select name="DropDownList" id="DropDownList">
                <option value="Edit">Edit Selected</option>
                <option value="Move">Move Selected</option>
                <option value="Delete">Delete Selected</option>
            </select>
            
            <input id="optionSubmit" type="submit" name="optionSubmit" value="Go" />
            <div id="moveButton"></div>
            <input type="button" name="Create" value="Create Folder" id="body-content-button-create" disabled />
            PAWA.Classes.AlbumGrid ag = new PAWA.Classes.AlbumGrid(new PAWA.DAL.PAWAContext());
            @Html.Raw(ag.CreateTable((int?)ViewBag.FolderID));
            
            <input type="submit" name="NextPage" value="Next Page" id="body-content-button-next" disabled /> 
            <input type="submit" name="GoToTop" value="Go To Top" id="body-content-button-top" disabled />
        }

    </div>
</div>
<div id="resultPopup" title="A popup box"></div>

<script type="text/javascript">
    var pop = window.alert;
    
    $(document).ready(function () {/*
        var buildform = function (values) {
            var returnValue = {};
            if (values != null && Object.getOwnPropertyNames(values) != null) {
                var elementIDList = Object.getOwnPropertyNames(values);
                for (var elementID in elementIDList) {
                    if ($("#" + elementID) != null) {
                        $("#" + elementID).name;
                    }
                }
            }
            return returnValue;
        }*/

        $("#resultPopup").dialog({ autoOpen: false });
        //window.alert("running");
        $("form").first().submit(function (event) {
          //  this.submitAllow = false;
        //$("#optionSubmit").click(function (event) {
            if ($('#DropDownList').val() == "Delete") {
                //check if anything was selected
                if (hasChecked()==false) {
                    //Nothing was so show a message.
                    alert("You have not selected any images to delete.");
                    event.preventDefault();
                    return;
                } else {
                    if (window.confirm('These images will be permanently deleted. Do you wish to continue?')) {
                        $('#DropDownList').val() = "Delete";
                        $("form:first").submit();
                    } else event.preventDefault();
                }
            }
            if ($("#DropDownList").val() == "Move") {
                
                if (hasChecked()) {
                    event.preventDefault();
                    pop("before");
                    var albumPost = $.post("../../Home/GetAlbumList", { userID: "1" }, function (data) {
                        pop("The chidren are safe");
                        $("#resultPopup").empty().append(data);
                        $("#resultPopup").dialog("open");

                        $("#folderList").onclick = function () {
                            var getCheckboxIDArray = function () {
                                var inputsArray = [];
                                var inputs = $("input[type='checkbox']");
                                for (var i = 0; i < inputs.length; i++) {
                                    var checkedInputID = inputs[i].id;
                                    if (inputs[i].checked && checkedInputID.search('_folder') != -1) {
                                        inputsArray.push[checked];
                                    }
                                }
                                return inputsArray;
                            }
                            pop(getCheckboxIDArray().serialize());
                            //$.post("../../Home/MoveImageToAlbum",{destinationFolder:$("#folderList").val(),'moveable[]':getCheckboxIDArray()},function(data){pop("works");});
                        }
                    });
                    pop("after");

                    // Put the results in a div
                    /*albumPost.done(function (data) {
                        var result = $(data);

                    });
                    //*/
                    $("#resultPopup").dialog("open");
                    pop("after post")
                }
            }
        });
    });
</script>

<script type="text/javascript">
    function hasChecked() {
        pop("hasChecked");
        //Get input elements
        var inputs = $("input[type='checkbox']");
        //window.alert(printList());

        //For all elements
        for (var i = 0; i < inputs.length; i++) {
            //If any are checked
            pop(inputs[i].checked);
            if (inputs[i].checked) {
                return true;
            }
        }
        //Nothing was selected
        return false;
    };
</script>

<script>
    $("#body-content-button-create").position({ my: "right top", at: "right-4 top+2", of: "#body-content-area", collision: "none" });
    $("#body-content-button-next").position({ my: "center bottom", at: "center bottom-2", of: "#body-content-area", collision: "none" });
    $("#body-content-button-top").position({ my: "right bottom", at: "right-4 bottom-2", of: "#body-content-area", collision: "none" });
    $(".body-content-table-checkbox").each(function () {
        $(this).position({ my: "right bottom", at: "right-5 bottom-5", of: $(this).parent().children("img"), collision: "none" });
    });
    $(".body-content-table-folder-text").each(function () {
        $(this).position({ my: "center", at: "center center+10", of: $(this).parent().children("img"), collision: "none" });
    });
</script>
